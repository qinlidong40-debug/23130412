<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>商品列表 - 23130412</title>
    <style>
        table {border-collapse: collapse; width: 80%; margin: 20px auto;}
        th,td {border: 1px solid #ccc; padding: 8px; text-align: center;}
        th {background-color: #f5f5f5;}
        .btn {text-decoration: none; padding: 4px 8px; color: white; background: #007bff; border-radius: 4px; margin: 0 2px;}
        .btn-del {background: #dc3545;}
        .add-btn {margin-left: 10%; margin-top: 20px; display: inline-block;}
    </style>
</head>
<body>
<h1 style="text-align: center;">商品管理列表</h1>
<a th:href="@{/goods/add}" class="btn add-btn">新增商品</a>
<!-- 批量删除按钮 -->
<button class="btn btn-del" onclick="batchDelete()">批量删除</button>

<table>
    <tr>
        <<th><input type="checkbox" id="checkAll">全选</</th> <!-- 全选框 -->
        <<th>ID</</th>
        <<th>商品名称</</th>
        <<th>价格</</th>
        <<th>生产商</</th>
        <<th>操作</</th>
    </tr>
    <tr th:each="goods : ${goodsList}">
        <td><input type="checkbox" class="checkItem" th:value="${goods.id}"></td> <!-- 单选框 -->
        <td th:text="${goods.id}"></td>
        <td th:text="${goods.gname}"></td>
        <td th:text="${goods.gprice}"></td>
        <td th:text="${goods.producer}"></td>
        <td>
            <a th:href="@{/goods/edit/{id}(id=${goods.id})}" class="btn">编辑</a>
            <a th:href="@{/goods/delete/{id}(id=${goods.id})}" class="btn btn-del" onclick="return confirm('确认删除？')">删除</a>
        </td>
    </tr>
</table>

<!-- 批量删除JS逻辑 -->
<script>
    // 全选/全不选
    document.getElementById("checkAll").onclick = function() {
        let items = document.getElementsByClassName("checkItem");
        for (let item of items) item.checked = this.checked;
    }

    // 批量删除
    function batchDelete() {
        let ids = [];
        document.querySelectorAll(".checkItem:checked").forEach(item => ids.push(item.value));
        if (ids.length === 0) {alert("请选择要删除的商品"); return;}
        if (confirm("确认批量删除？")) {
            fetch("/goods/delete/batch", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(ids)
            }).then(res => res.json()).then(data => {
                alert(data.msg);
                location.reload(); // 刷新列表
            });
        }
    }
</script>
</body>
</html>